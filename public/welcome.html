<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
  <title>Kimi Free API â€” Interactive API Explorer</title>
  <style>
    :root {
      --bg: #fafbfc;
      --surface: #ffffff;
      --text: #1b1f24;
      --muted: #57606a;
      --subtle: #6e7781;
      --border: #d0d7de;
      --border-light: #e8ecf0;
      --primary: #667eea;
      --primary-2: #764ba2;
      --accent: #0969da;
      --success: #1a7f37;
      --success-bg: #dafbe1;
      --warning: #cf222e;
      --warning-bg: #ffebe9;
      --get-color: #1a7f37;
      --get-bg: #dafbe1;
      --get-border: #aceebb;
      --post-color: #0550ae;
      --post-bg: #ddf4ff;
      --post-border: #80ccff;
      --radius: 8px;
      --shadow: 0 1px 3px rgba(27,31,36,0.06), 0 1px 2px rgba(27,31,36,0.04);
      --shadow-md: 0 4px 12px rgba(27,31,36,0.08);
      --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
    }

    *, *::before, *::after { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: var(--font-sans);
      color: var(--text);
      background: var(--bg);
      line-height: 1.6;
    }

    .container { max-width: 960px; margin: 0 auto; padding: 0 20px; }

    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      color: #fff;
      padding: 32px 0 28px;
    }
    header h1 { margin: 0 0 6px; font-size: 28px; font-weight: 800; }
    header p { margin: 0; opacity: 0.9; font-size: 15px; }
    .base-url-box {
      margin-top: 16px;
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.25);
      border-radius: var(--radius);
      padding: 10px 14px;
      font-family: var(--font-mono);
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(4px);
    }
    .base-url-box .label { font-weight: 700; opacity: 0.8; font-family: var(--font-sans); font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .base-url-box .url { font-weight: 600; word-break: break-all; }

    .section { margin: 24px 0; }
    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .section-icon { font-size: 20px; }

    .auth-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }
    .auth-card label {
      display: block;
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 6px;
      color: var(--muted);
    }
    .auth-card textarea {
      width: 100%;
      min-height: 80px;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
      font-family: var(--font-mono);
      font-size: 12px;
      resize: vertical;
      outline: none;
      transition: border-color 0.15s;
    }
    .auth-card textarea:focus { border-color: var(--primary); }
    .auth-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--surface);
      color: var(--text);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn:hover { background: var(--bg); border-color: #b0b8c2; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      color: #fff;
      border: none;
    }
    .btn-primary:hover { opacity: 0.9; }
    .btn-success { background: var(--success); color: #fff; border: none; }
    .btn-success:hover { opacity: 0.9; }
    .btn-danger { background: var(--warning); color: #fff; border: none; }
    .btn-danger:hover { opacity: 0.9; }

    .token-info {
      margin-top: 12px;
      padding: 12px;
      background: #f6f8fa;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      font-size: 13px;
      display: none;
    }
    .token-info.visible { display: block; }
    .token-preview {
      font-family: var(--font-mono);
      font-size: 11px;
      word-break: break-all;
      color: var(--muted);
      margin: 6px 0;
      max-height: 60px;
      overflow: hidden;
    }
    .token-status {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
    }
    .token-valid { background: var(--success-bg); color: var(--success); }
    .token-expired { background: var(--warning-bg); color: var(--warning); }
    .token-unknown { background: #f6f8fa; color: var(--muted); }

    .endpoint-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 10px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .endpoint-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      cursor: pointer;
      user-select: none;
      transition: background 0.1s;
    }
    .endpoint-header:hover { background: #f6f8fa; }
    .method-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 56px;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      flex-shrink: 0;
    }
    .method-get { background: var(--get-bg); color: var(--get-color); border: 1px solid var(--get-border); }
    .method-post { background: var(--post-bg); color: var(--post-color); border: 1px solid var(--post-border); }
    .endpoint-path {
      font-family: var(--font-mono);
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      flex: 1;
    }
    .endpoint-desc {
      font-size: 13px;
      color: var(--muted);
      margin-left: auto;
      text-align: right;
      white-space: nowrap;
    }
    .endpoint-toggle {
      font-size: 18px;
      color: var(--muted);
      transition: transform 0.2s;
      flex-shrink: 0;
    }
    .endpoint-card.open .endpoint-toggle { transform: rotate(180deg); }

    .endpoint-body {
      display: none;
      border-top: 1px solid var(--border-light);
      padding: 16px;
    }
    .endpoint-card.open .endpoint-body { display: block; }

    .form-group { margin-bottom: 12px; }
    .form-group label {
      display: block;
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s;
      font-family: var(--font-mono);
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus { border-color: var(--primary); }
    .form-group select { font-family: var(--font-sans); }
    .form-group textarea { min-height: 120px; resize: vertical; }

    .form-row { display: flex; gap: 12px; }
    .form-row .form-group { flex: 1; }
    @media (max-width: 640px) { .form-row { flex-direction: column; } }

    .execute-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 12px;
    }

    .response-area {
      margin-top: 16px;
      display: none;
    }
    .response-area.visible { display: block; }
    .response-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 13px;
      font-weight: 700;
    }
    .status-code {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 700;
      font-family: var(--font-mono);
    }
    .status-2xx { background: var(--success-bg); color: var(--success); }
    .status-4xx, .status-5xx { background: var(--warning-bg); color: var(--warning); }
    .response-body {
      background: #1e1e2e;
      color: #cdd6f4;
      border-radius: 6px;
      padding: 14px;
      font-family: var(--font-mono);
      font-size: 12px;
      line-height: 1.5;
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .response-body .json-key { color: #89b4fa; }
    .response-body .json-string { color: #a6e3a1; }
    .response-body .json-number { color: #fab387; }
    .response-body .json-bool { color: #cba6f7; }
    .response-body .json-null { color: #6c7086; }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }
    .spinner-dark {
      border-color: rgba(0,0,0,0.1);
      border-top-color: var(--primary);
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .disclaimer {
      margin: 24px 0;
      padding: 14px 16px;
      border: 1px solid #fad1d6;
      border-left: 4px solid var(--warning);
      background: #fff7f7;
      border-radius: var(--radius);
      font-size: 13px;
      color: #6b1a20;
    }
    .disclaimer strong { color: #8b1c24; }

    footer {
      text-align: center;
      padding: 24px 0;
      color: var(--subtle);
      font-size: 13px;
      border-top: 1px solid var(--border-light);
      margin-top: 24px;
    }

    .loading-overlay {
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
      z-index: 10;
    }

    @media (max-width: 640px) {
      header h1 { font-size: 22px; }
      .endpoint-desc { display: none; }
      .container { padding: 0 14px; }
      .endpoint-header { padding: 10px 12px; gap: 8px; }
      .method-badge { min-width: 44px; font-size: 11px; padding: 3px 6px; }
      .endpoint-path { font-size: 12px; }
    }

    .optgroup-label {
      font-weight: 700;
      color: var(--text);
    }
  </style>
</head>
<body>

  <header>
    <div class="container">
      <h1>Kimi Free API Explorer</h1>
      <p>Interactive API documentation & testing interface. Compatible with OpenAI, Claude, and Gemini formats.</p>
      <div class="base-url-box">
        <span class="label">Base URL</span>
        <span class="url" id="baseUrl">Loading...</span>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="disclaimer">
      <strong>Disclaimer:</strong> This is a reverse-engineered API and may be unstable. It is recommended to use the official paid API for production use. This project is for research and learning purposes only, not for commercial use.
    </div>

    <section class="section" id="auth-section">
      <div class="section-title">
        <span class="section-icon">&#128274;</span>
        Authentication
      </div>
      <div class="auth-card">
        <label for="cookieInput">Paste full cookie string or kimi-auth JWT token</label>
        <textarea id="cookieInput" placeholder='Paste cookies like: _ga=...; kimi-auth=eyJhbGci... &#10;Or just the JWT token: eyJhbGci...'></textarea>
        <div class="auth-actions">
          <button class="btn btn-primary" onclick="extractToken()">Extract & Save Token</button>
          <button class="btn" onclick="loadSavedToken()">Load Saved</button>
          <button class="btn btn-danger" onclick="clearToken()">Clear Token</button>
        </div>
        <div class="token-info" id="tokenInfo">
          <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
            <strong>Token Status:</strong>
            <span class="token-status" id="tokenStatus"></span>
          </div>
          <div class="token-preview" id="tokenPreview"></div>
        </div>
      </div>
    </section>

    <section class="section" id="api-section">
      <div class="section-title">
        <span class="section-icon">&#128640;</span>
        API Endpoints
      </div>
      <div id="endpointList"></div>
    </section>
  </main>

  <footer>
    <div class="container">
      Kimi Free API Explorer &mdash; Built for developers
    </div>
  </footer>

  <script>
    const BASE_URL = window.location.origin;
    document.getElementById('baseUrl').textContent = BASE_URL;

    const MODELS = {
      'K2.5': ['kimi-k2.5-instant', 'kimi-k2.5-thinking', 'kimi-k2.5-agent', 'kimi-k2.5-agent-swarm'],
      'K2': ['kimi-k2-0905-preview', 'kimi-k2-0711-preview', 'kimi-k2-turbo-preview', 'kimi-k2-thinking', 'kimi-k2-thinking-turbo'],
      'Moonshot': ['moonshot-v1-8k', 'moonshot-v1-32k', 'moonshot-v1-128k'],
      'Vision': ['moonshot-v1-8k-vision-preview', 'moonshot-v1-32k-vision-preview', 'moonshot-v1-128k-vision-preview'],
      'Latest': ['kimi-latest']
    };

    let fetchedModels = null;

    const ENDPOINTS = [
      {
        method: 'GET', path: '/ping', desc: 'Health check',
        hasBody: false, hasModel: false, hasAuth: false
      },
      {
        method: 'GET', path: '/v1/models', desc: 'List available models',
        hasBody: false, hasModel: false, hasAuth: false
      },
      {
        method: 'POST', path: '/v1/chat/completions', desc: 'Chat completion (OpenAI format)',
        hasBody: true, hasModel: true, hasAuth: true, hasStream: true,
        defaultBody: {
          model: 'kimi-k2.5-instant',
          messages: [{ role: 'user', content: 'Hello' }],
          stream: false
        }
      },
      {
        method: 'POST', path: '/v1/messages', desc: 'Chat completion (Claude format)',
        hasBody: true, hasModel: true, hasAuth: true, hasStream: true,
        defaultBody: {
          model: 'kimi-k2.5-instant',
          max_tokens: 1024,
          messages: [{ role: 'user', content: 'Hello' }],
          stream: false
        }
      },
      {
        method: 'POST', path: '/v1beta/models/:model:generateContent', desc: 'Content generation (Gemini format)',
        hasBody: true, hasModel: true, hasAuth: true, hasModelInPath: true,
        defaultBody: {
          contents: [{ parts: [{ text: 'Hello' }] }]
        }
      },
      {
        method: 'POST', path: '/v1beta/models/:model:streamGenerateContent', desc: 'Streaming content (Gemini format)',
        hasBody: true, hasModel: true, hasAuth: true, hasModelInPath: true,
        defaultBody: {
          contents: [{ parts: [{ text: 'Hello' }] }]
        }
      },
      {
        method: 'GET', path: '/v1beta/models', desc: 'List Gemini models',
        hasBody: false, hasModel: false, hasAuth: false
      },
      {
        method: 'POST', path: '/token/check', desc: 'Check token validity',
        hasBody: true, hasModel: false, hasAuth: false,
        defaultBody: { token: '' }
      },
      {
        method: 'POST', path: '/auth/extract', desc: 'Extract kimi-auth from cookies',
        hasBody: true, hasModel: false, hasAuth: false,
        defaultBody: { cookie: '_ga=...; kimi-auth=eyJ...' }
      }
    ];

    function getToken() {
      return localStorage.getItem('kimi_auth_token') || '';
    }

    function decodeJWT(token) {
      try {
        const parts = token.split('.');
        if (parts.length !== 3) return null;
        const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
        return payload;
      } catch { return null; }
    }

    function extractToken() {
      const input = document.getElementById('cookieInput').value.trim();
      if (!input) return;

      let token = '';
      if (input.startsWith('eyJ')) {
        token = input.split(';')[0].trim();
      } else {
        const match = input.match(/kimi-auth=([^;\s]+)/);
        if (match) {
          token = match[1];
        } else {
          const jwtMatch = input.match(/(eyJ[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+)/);
          if (jwtMatch) token = jwtMatch[1];
        }
      }

      if (!token) {
        alert('Could not find a valid JWT token. Please paste a cookie string containing kimi-auth or a JWT token starting with eyJ...');
        return;
      }

      localStorage.setItem('kimi_auth_token', token);
      showTokenInfo(token);
      updateAuthFields();
    }

    function loadSavedToken() {
      const token = getToken();
      if (token) {
        document.getElementById('cookieInput').value = token;
        showTokenInfo(token);
      } else {
        alert('No saved token found.');
      }
    }

    function clearToken() {
      localStorage.removeItem('kimi_auth_token');
      document.getElementById('cookieInput').value = '';
      document.getElementById('tokenInfo').classList.remove('visible');
      updateAuthFields();
    }

    function showTokenInfo(token) {
      const info = document.getElementById('tokenInfo');
      const status = document.getElementById('tokenStatus');
      const preview = document.getElementById('tokenPreview');

      info.classList.add('visible');
      preview.textContent = token.substring(0, 80) + (token.length > 80 ? '...' : '');

      const payload = decodeJWT(token);
      if (payload && payload.exp) {
        const expDate = new Date(payload.exp * 1000);
        const now = new Date();
        if (expDate > now) {
          status.className = 'token-status token-valid';
          status.textContent = '\u2713 Valid \u2014 Expires: ' + expDate.toLocaleString();
        } else {
          status.className = 'token-status token-expired';
          status.textContent = '\u2717 Expired: ' + expDate.toLocaleString();
        }
      } else {
        status.className = 'token-status token-unknown';
        status.textContent = 'Token saved (expiry unknown)';
      }
    }

    function updateAuthFields() {
      const token = getToken();
      document.querySelectorAll('.auth-input').forEach(el => {
        el.value = token ? 'Bearer ' + token : '';
      });
    }

    function buildModelSelect(id) {
      let html = '<select id="' + id + '" class="model-select" style="font-family:var(--font-sans)">';
      for (const [group, models] of Object.entries(MODELS)) {
        html += '<optgroup label="' + group + '">';
        for (const m of models) {
          html += '<option value="' + m + '">' + m + '</option>';
        }
        html += '</optgroup>';
      }
      html += '</select>';
      return html;
    }

    function syntaxHighlight(json) {
      if (typeof json !== 'string') json = JSON.stringify(json, null, 2);
      return json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
        .replace(/("(\\u[a-fA-F0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?)/g, function(match) {
          let cls = 'json-string';
          if (/:$/.test(match)) {
            cls = 'json-key';
            return '<span class="' + cls + '">' + match.slice(0, -1) + '</span>:';
          }
          return '<span class="' + cls + '">' + match + '</span>';
        })
        .replace(/\b(true|false)\b/g, '<span class="json-bool">$1</span>')
        .replace(/\bnull\b/g, '<span class="json-null">null</span>')
        .replace(/\b(-?\d+\.?\d*([eE][+-]?\d+)?)\b/g, '<span class="json-number">$1</span>');
    }

    function renderEndpoints() {
      const container = document.getElementById('endpointList');
      container.innerHTML = '';

      ENDPOINTS.forEach((ep, idx) => {
        const card = document.createElement('div');
        card.className = 'endpoint-card';
        card.id = 'ep-' + idx;

        const methodClass = ep.method === 'GET' ? 'method-get' : 'method-post';

        let bodyHtml = '';
        if (ep.hasBody || ep.hasModel || ep.hasAuth) {
          bodyHtml += '<div class="endpoint-body">';

          if (ep.hasAuth) {
            bodyHtml += '<div class="form-group"><label>Authorization</label>';
            bodyHtml += '<input type="text" class="auth-input" id="auth-' + idx + '" placeholder="Bearer your-token-here" value="' + (getToken() ? 'Bearer ' + getToken() : '') + '"/></div>';
          }

          if (ep.hasModel) {
            bodyHtml += '<div class="form-row">';
            bodyHtml += '<div class="form-group"><label>Model</label>' + buildModelSelect('model-' + idx) + '</div>';
            if (ep.hasStream) {
              bodyHtml += '<div class="form-group"><label>Streaming</label><select id="stream-' + idx + '"><option value="false">No</option><option value="true">Yes</option></select></div>';
            }
            bodyHtml += '</div>';
          }

          if (ep.hasBody) {
            const body = ep.defaultBody ? JSON.stringify(ep.defaultBody, null, 2) : '{}';
            bodyHtml += '<div class="form-group"><label>Request Body</label>';
            bodyHtml += '<textarea id="body-' + idx + '">' + body + '</textarea></div>';
          }

          bodyHtml += '<div class="execute-bar">';
          bodyHtml += '<button class="btn btn-primary" onclick="executeRequest(' + idx + ')">&#9654; Execute</button>';
          bodyHtml += '<span id="loader-' + idx + '" style="display:none"><span class="spinner spinner-dark"></span></span>';
          bodyHtml += '</div>';

          bodyHtml += '<div class="response-area" id="response-' + idx + '">';
          bodyHtml += '<div class="response-header">Response <span class="status-code" id="status-' + idx + '"></span></div>';
          bodyHtml += '<pre class="response-body" id="respBody-' + idx + '"></pre>';
          bodyHtml += '</div>';

          bodyHtml += '</div>';
        } else {
          bodyHtml += '<div class="endpoint-body">';
          bodyHtml += '<div class="execute-bar">';
          bodyHtml += '<button class="btn btn-primary" onclick="executeRequest(' + idx + ')">&#9654; Execute</button>';
          bodyHtml += '<span id="loader-' + idx + '" style="display:none"><span class="spinner spinner-dark"></span></span>';
          bodyHtml += '</div>';
          bodyHtml += '<div class="response-area" id="response-' + idx + '">';
          bodyHtml += '<div class="response-header">Response <span class="status-code" id="status-' + idx + '"></span></div>';
          bodyHtml += '<pre class="response-body" id="respBody-' + idx + '"></pre>';
          bodyHtml += '</div>';
          bodyHtml += '</div>';
        }

        card.innerHTML = '<div class="endpoint-header" onclick="toggleEndpoint(' + idx + ')">' +
          '<span class="method-badge ' + methodClass + '">' + ep.method + '</span>' +
          '<span class="endpoint-path">' + ep.path + '</span>' +
          '<span class="endpoint-desc">' + ep.desc + '</span>' +
          '<span class="endpoint-toggle">&#9660;</span>' +
          '</div>' + bodyHtml;

        container.appendChild(card);
      });
    }

    function toggleEndpoint(idx) {
      const card = document.getElementById('ep-' + idx);
      card.classList.toggle('open');
    }

    async function executeRequest(idx) {
      const ep = ENDPOINTS[idx];
      const loader = document.getElementById('loader-' + idx);
      const responseArea = document.getElementById('response-' + idx);
      const statusEl = document.getElementById('status-' + idx);
      const respBody = document.getElementById('respBody-' + idx);

      loader.style.display = 'inline-block';
      responseArea.classList.remove('visible');

      let url = BASE_URL + ep.path;
      const opts = { method: ep.method, headers: {} };

      if (ep.hasAuth) {
        const authVal = document.getElementById('auth-' + idx).value.trim();
        if (authVal) opts.headers['Authorization'] = authVal;
      }

      let bodyObj = null;
      if (ep.hasBody) {
        try {
          bodyObj = JSON.parse(document.getElementById('body-' + idx).value);
        } catch(e) {
          loader.style.display = 'none';
          responseArea.classList.add('visible');
          statusEl.className = 'status-code status-4xx';
          statusEl.textContent = 'ERR';
          respBody.textContent = 'Invalid JSON in request body: ' + e.message;
          return;
        }
      }

      if (ep.hasModel) {
        const model = document.getElementById('model-' + idx).value;
        if (bodyObj) bodyObj.model = model;
        if (ep.hasModelInPath) {
          url = BASE_URL + ep.path.replace(':model', model);
        }
      }

      let isStream = false;
      if (ep.hasStream) {
        isStream = document.getElementById('stream-' + idx).value === 'true';
        if (bodyObj) bodyObj.stream = isStream;
      }

      if (bodyObj) {
        opts.headers['Content-Type'] = 'application/json';
        opts.body = JSON.stringify(bodyObj);
      }

      try {
        const res = await fetch(url, opts);
        const statusCode = res.status;
        statusEl.textContent = statusCode;
        statusEl.className = 'status-code ' + (statusCode >= 200 && statusCode < 300 ? 'status-2xx' : statusCode >= 400 && statusCode < 500 ? 'status-4xx' : 'status-5xx');

        if (isStream && res.ok) {
          responseArea.classList.add('visible');
          respBody.innerHTML = '';
          const reader = res.body.getReader();
          const decoder = new TextDecoder();
          let accumulated = '';

          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            const chunk = decoder.decode(value, { stream: true });
            accumulated += chunk;
            respBody.textContent = accumulated;
            respBody.scrollTop = respBody.scrollHeight;
          }
        } else {
          const text = await res.text();
          let formatted;
          try {
            const json = JSON.parse(text);
            formatted = syntaxHighlight(JSON.stringify(json, null, 2));
          } catch {
            formatted = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
          }
          respBody.innerHTML = formatted;
          responseArea.classList.add('visible');
        }
      } catch(e) {
        statusEl.className = 'status-code status-5xx';
        statusEl.textContent = 'ERR';
        respBody.textContent = 'Request failed: ' + e.message;
        responseArea.classList.add('visible');
      }

      loader.style.display = 'none';
    }

    async function fetchModels() {
      try {
        const res = await fetch(BASE_URL + '/v1/models');
        if (res.ok) {
          const data = await res.json();
          if (data.data && Array.isArray(data.data)) {
            fetchedModels = data.data.map(m => m.id || m);
            updateModelSelects();
          }
        }
      } catch {}
    }

    function updateModelSelects() {
      if (!fetchedModels || fetchedModels.length === 0) return;
      document.querySelectorAll('.model-select').forEach(sel => {
        const currentVal = sel.value;
        sel.innerHTML = '';

        for (const [group, models] of Object.entries(MODELS)) {
          const optgroup = document.createElement('optgroup');
          optgroup.label = group;
          for (const m of models) {
            const opt = document.createElement('option');
            opt.value = m;
            opt.textContent = m;
            optgroup.appendChild(opt);
          }
          sel.appendChild(optgroup);
        }

        const extraModels = fetchedModels.filter(fm => {
          return !Object.values(MODELS).flat().includes(fm);
        });
        if (extraModels.length > 0) {
          const optgroup = document.createElement('optgroup');
          optgroup.label = 'Other (from API)';
          for (const m of extraModels) {
            const opt = document.createElement('option');
            opt.value = m;
            opt.textContent = m;
            optgroup.appendChild(opt);
          }
          sel.appendChild(optgroup);
        }

        if (currentVal && [...sel.options].some(o => o.value === currentVal)) {
          sel.value = currentVal;
        }
      });
    }

    function init() {
      renderEndpoints();
      const saved = getToken();
      if (saved) {
        showTokenInfo(saved);
      }
      fetchModels();
    }

    init();
  </script>
</body>
</html>
